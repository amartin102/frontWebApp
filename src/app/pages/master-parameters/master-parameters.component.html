<p-card header="Maestro de Parámetros">
  <!-- Filtros -->
  <div class="filters p-fluid grid">
    <div class="field col-12 md:col-8">
      <label for="codeFilter">Código Parámetro</label>
      <input 
        pInputText 
        id="codeFilter" 
        [formControl]="codeControl" 
        placeholder="Buscar por código..." 
        (keyup.enter)="search()"
      />
    </div>

    <div class="field col-12 md:col-4 flex align-items-end gap-2">
       <button pButton icon="pi pi-refresh" label="Limpiar" class="p-button-secondary" (click)="clearFilters()"></button>
      <button pButton icon="pi pi-plus" label="Agregar Parámetro" class="p-button-primary" (click)="addParameter()"></button>     
    </div>
  </div>

  <!-- Mensajes -->
  <p-message *ngIf="errorMessage" severity="error" [text]="errorMessage"></p-message>

  <!-- Tabla de resultados -->
  <p-table 
    [value]="filteredParameters" 
    [paginator]="true" 
    [rows]="10"
    [rowsPerPageOptions]="[10, 20, 50]"
    [loading]="loading"
    styleClass="p-datatable-striped p-datatable-sm"
    [tableStyle]="{'min-width': '60rem'}">
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 12%">Código</th>
        <th style="width: 20%">Descripción</th>
        <th style="width: 12%">Tipo Dato</th>
        <th style="width: 10%">Origen</th>
        <th style="width: 12%">Nivel Inconsistencia</th>
        <th style="width: 10%">Permiso Modificar</th>
        <th style="width: 10%">Permiso Consultar</th>
        <th style="width: 10%">Creado Por</th>
        <th style="width: 12%">Fecha Creación</th>
        <th style="width: 8%">Acciones</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-param>
      <tr>
        <td><strong>{{ param.code }}</strong></td>
        <td>{{ param.description || '-' }}</td>
        <td>
          <span class="data-type-badge">{{ param.dataTypeDescription }}</span>
        </td>
        <td>{{ param.dataOrigin || '-' }}</td>
        <td>
          <span [class]="'inconsistency-badge level-' + param.inconsistencyLevelId">
            {{ param.inconsistencyLevelDescription }}
          </span>
        </td>
        <td>{{ param.modifyPermission }}</td>
        <td>{{ param.consultPermission }}</td>
        <td>{{ param.createdBy }}</td>
        <td>{{ param.creationDate | date: 'yyyy-MM-dd HH:mm' }}</td>
        <td>
          <div class="flex gap-1">
              <button pButton icon="pi pi-pencil" class="p-button-outlined p-button-sm p-button-info" 
                    (click)="editParameter(param)" pTooltip="Editar" tooltipPosition="top"></button>
              <button pButton icon="pi pi-trash" class="p-button-outlined p-button-sm p-button-danger" 
                    (click)="deleteParameter(param)" pTooltip="Eliminar" tooltipPosition="top"></button>
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="10" class="text-center p-4">
          <i class="pi pi-inbox" style="font-size: 2rem; color: #ccc;"></i>
          <p class="mt-2 text-color-secondary">No se encontraron parámetros</p>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="loadingbody">
      <tr>
        <td colspan="10" class="text-center p-4">
          <i class="pi pi-spin pi-spinner" style="font-size: 2rem;"></i>
          <p class="mt-2 text-color-secondary">Cargando parámetros...</p>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Resumen -->
  <div class="mt-3 text-sm text-color-secondary">
    Mostrando {{ filteredParameters.length }} de {{ allParameters.length }} parámetros
  </div>
</p-card>
